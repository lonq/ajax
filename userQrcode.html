<!DOCTYPE html>
<html lang="zh-CN" class="fullpage">

<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="screen-orientation" content="portrait">
    <meta name="x5-orientation" content="portrait">
    <meta name="format-detection" content="telephone=no,email=no">
    <meta name="author" content="lonq">
    <meta name="copyright" content="lonq">
    <title>我的名片</title>
    <link href="css/normalize.css" rel="stylesheet">
    <link href="css/global.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="js/swiper-4.4.1/dist/css/swiper.min.css" rel="stylesheet">
    <link href="js/dialog2-master/dist/css/dialog.css" rel="stylesheet">
    <link href="css/iconfont/iconfont.css" rel="stylesheet">
    <script src="js/flexible.js"></script>
</head>

<body class="bg-dark">

    <header>
        <nav class="navbar navbar-dark affix affix-top">
            <ul class="navbar-left">
                <li><a href="javascript:history.go(-1);"><i class="iconfont-angleleft"></i></a></li>
            </ul>
            <h3 class="navbar-title">我的名片</h3>
            <ul class="navbar-left">
                <li class="js-share-btn"><a href="javascript:;"><i class="iconfont-share"></i></a></li>
            </ul>
        </nav>
    </header>

    <div class="js-content flex-wrap vertical-center margin-horizontal-lg full-height"></div>

    <div class="actionsheet-backdrop backdrop"></div>

    <div class="actionsheet share-actionsheet padding-horizontal padding-bottom">
        <div class="actionsheet-title">
            <i class="close iconfont-wrong"></i>
        </div>
        <ul class="actionsheet-menu share-actionsheet">
            <li>
                <dl>
                    <dt class="iconfont-qzone"></dt>
                    <dd>QQ空间</dd>
                </dl>
            </li>
            <li>
                <dl>
                    <dt class="iconfont-weibo"></dt>
                    <dd>微博</dd>
                </dl>
            </li>
            <li>
                <dl>
                    <dt class="iconfont-weixin"></dt>
                    <dd>微信</dd>
                </dl>
            </li>
            <li>
                <dl>
                    <dt class="iconfont-wxzone"></dt>
                    <dd>微信朋友圈</dd>
                </dl>
            </li>
        </ul>
    </div>

    <script src="js/zepto.min.js"></script>
    <script src="js/touch.min.js"></script>
    <script src="js/checkLogin.js"></script>
    <script src="js/zepto.cookie.min.js"></script>
    <script src="js/swiper-4.4.1/dist/js/swiper.min.js"></script>
    <script src="js/timeago.js-master/dist/timeago.min.js"></script>
    <script src="js/dialog2-master/dist/js/dialog.min.js"></script>
    <script src="js/qrcodejs-master/qrcode.min.js"></script>
    <script src="js/common.js"></script>

    <script type="text/javascript">
        //<![CDATA[
        var adminName = HtmlUtil.getCookie($.fn.cookie('LQCookies'), 'AdminName'); // 用户名
        $(function () {
            // 插入正文
            getContent();
            //底部弹出菜单
            $('.js-share-btn').on('click', function () {
                showActionSheet();
            });
        });
        // 显示actionsheet
        function showActionSheet() {
            var actionsheet = $('.actionsheet');
            var mask = $('.actionsheet-backdrop');
            var actionsheetCancel = $('.actionsheet-cancel, .actionsheet .close');
            mask.on('click', hideActionSheet);
            actionsheetCancel.on('click', hideActionSheet);
            actionsheet.addClass('actionsheet-toggle');
            backdropState('actionsheet-backdrop', 'on');
        }
        // 关闭actionsheet
        function hideActionSheet() {
            var actionsheet = $('.actionsheet');
            actionsheet.removeClass('actionsheet-toggle');
            backdropState('actionsheet-backdrop', 'off');
        }
        // 文章正文
        function getContent() {
            $.ajax({
                type: 'GET',
                url: 'getUser.asp?Action=content',
                data: {
                    AdminName: adminName
                },
                timeout: 15000,
                dataType: 'json',
                success: function (reponse) {
                    // 无数据
                    if (reponse == 0) {
                        pullUp.hide().html();
                        pullDown.hide();
                        noData('default', '什么也没找到~');
                    } else {
                        // 有数据
                        var str = '';
                        var username = reponse.adminname;
                        var userPetname = reponse.adminpetname;
                        var userSignature = reponse.adminsignature;
                        var userFace = reponse.adminface;
                        var userCode = '测试';
                        if (userFace) {
                            userFace = userFace;
                        } else {
                            userFace = 'images/placeholder-avatar.jpg';
                        }
                        if (userPetname) {
                            userPetname = userPetname;
                        } else {
                            userPetname = username;
                        }
                        if (userSignature) {
                            userSignature = userSignature;
                        } else {
                            userSignature = '他很懒，什么都没留下。';
                        }
                        str += '<div class="list clear-border user-qrcode-wrap">' +
                            '<div class="item item-avatar vertical-center">' +
                            '<div class="avatar"><img src="' + userFace + '"></div>' +
                            '<div class="item-body overflow-hidden space-top">' +
                            '<h4 class="title text-ellipsis">' + userPetname + '</h4>' +
                            '<p class="text-muted text-xs text-ellipsis-2">' + userSignature + '</p>' +
                            '</div>' +
                            '</div>' +
                            '<div class="item horizontal-center">' +
                            '<div id="userQrcode" class="user-qrcode"><img class="icon" src="images/mini-logo.png"></div>' +
                            '</div>' +
                            '<div class="item horizontal-center text-sm text-muted">扫描二维码，加我为好友</div>' +
                            '</div>';
                        $('.js-content').html(str);
                        // 生成二维码
                        var qrcode = new QRCode('userQrcode', {
                            text: userCode,
                            width: 400,
                            height: 400,
                            colorDark: '#000000',
                            colorLight: '#ffffff',
                            correctLevel: QRCode.CorrectLevel.H
                        });
                    }
                },
                error: function (xhr, type, errorThrown) {
                    pullUp.html('加载失败！');
                }
            });
        }
        // 遮罩层
        function backdropState(classnames, state) {
            if ($('div').hasClass(classnames)) {
                if (state == 'on') {
                    $('html, body').css({
                        'overflow': 'hidden'
                    });
                    $('.' + classnames).addClass('backdrop-toggle');
                }
                if (state == 'off') {
                    $('html, body').css({
                        'overflow': ''
                    });
                    $('.' + classnames).removeClass('backdrop-toggle');
                }
            }
        }
        // 消息提示
        function msg(str) {
            $(document).dialog({
                type: 'notice',
                infoText: str,
                autoClose: 1500,
                position: 'bottom'
            });
        }
        // 消息提示
        function noData(type, text) {
            var color, icon;
            switch (type) {
                case 'primary':
                    color = 'msg msg-primary';
                    icon = 'icon iconfont-correctcircle';
                    break;
                default:
                    color = 'msg msg-default';
                    icon = 'icon iconfont-infocircle';
            }
            var str = '';
            str += '<div class="' + color + '">';
            str += '<h1><i class="' + icon + '"></i></h1>' +
                '<h3 class="text-center">' + text + '</h3>' +
                '</div>';
            targetObj.html(str);
        }
        //]]>
    </script>
</body>

</html>