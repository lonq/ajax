/*!
 * image-process v0.0.1
 * (c) 2017-2017 dailc
 * Released under the MIT License.
 * https://github.com/dailc/image-process
 */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.ImageScale=i()}(this,function(){"use strict";function t(t,i,a,e,r,o){for(var n=r/i,h=o/a,f=e,d=0;d<r;d+=1)for(var c=0;c<o;c+=1)!function(e,o){var d=Math.min(i-1,e/n),c=Math.min(a-1,o/h),v=Math.floor(d),u=Math.floor(c),g=o*r+e,m=u*i+v;g*=4,m*=4;for(var s=0;s<=3;s+=1)f[g+s]=t[m+s]}(d,c)}function i(i,a){return t(i.data,i.width,i.height,a.data,a.width,a.height),a}function a(t,i,a,e,r){var o=e,n=r;o>=a?o=a-1:o<0&&(o=0),n>=i?n=i-1:n<0&&(n=0);var h=o*i+n;return h*=4,[t[h+0],t[h+1],t[h+2],t[h+3]]}function e(t,i,e,r,o,n){for(var h=o/i,f=n/e,d=r,c=0;c<o;c+=1)for(var v=0;v<n;v+=1)!function(r,n){var c=Math.min(i-1,r/h),v=Math.min(e-1,n/f),u=Math.floor(c),g=Math.floor(v),m=c-u,s=v-g,l=1-m,w=1-s,M=n*o+r;M*=4;for(var p=a(t,i,e,g+0,u+0),x=a(t,i,e,g+0,u+1),R=a(t,i,e,g+1,u+0),S=a(t,i,e,g+1,u+1),I=0;I<=3;I+=1){var y=s*(l*R[I]+m*S[I]),k=w*(l*p[I]+m*x[I]);d[M+I]=y+k}}(c,v)}function r(t,i){return e(t.data,t.width,t.height,i.data,i.width,i.height),i}function o(t,i,a,e,r,o){for(var n=e,h=r/i,f=o/a,d=0;d<r;d+=1)for(var c=0;c<o;c+=1)!function(e,o){var d=Math.min(i-1,e/h),c=Math.min(a-1,o/f),v=Math.floor(d),u=Math.floor(c),g=d-v,m=c-u,s=o*r+e;s*=4;for(var l=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],w=0;w<=3;w+=1){for(var M=-1;M<=2;M+=1)for(var p=-1;p<=2;p+=1)l[M+1][p+1]=W(t,i,a,u+M,v+p,w);E(l),n[s+w]=B(O(m,g))}}(d,c)}function n(t,i){return o(t.data,t.width,t.height,i.data,i.width,i.height),i}function h(t){var i=t>=0?t:-t,a=t*t,e=i*a;return i<=1?1-(U+3)*a+(U+2)*e:i<=2?-4*U+8*U*i-5*U*a+U*e:0}function f(t){var i=t;return i=Math.min(255,i),i=Math.max(0,i)}function d(t,i,a,e,r){var o=e,n=r;o>=a?o=a-1:o<0&&(o=0),n>=i?n=i-1:n<0&&(n=0);var h=o*i+n;return h*=4,[t[h+0],t[h+1],t[h+2],t[h+3]]}function c(t,i,a,e,r,o){for(var n=e,c=r/i,v=o/a,u=0;u<r;u+=1)for(var g=0;g<o;g+=1)!function(e,o){var u=Math.min(i-1,e/c),g=Math.min(a-1,o/v),m=Math.floor(u),s=Math.floor(g),l=u-m,w=g-s,M=o*r+e;M*=4;for(var p=[0,0,0,0],x=-1;x<=2;x+=1)for(var R=-1;R<=2;R+=1){var S=d(t,i,a,s+x,m+R),I=h(x-w)*h(R-l);p[0]+=S[0]*I,p[1]+=S[1]*I,p[2]+=S[2]*I,p[3]+=S[3]*I}n[M+0]=f(p[0]),n[M+1]=f(p[1]),n[M+2]=f(p[2]),n[M+3]=f(p[3])}(u,g)}function v(t,i){return c(t.data,t.width,t.height,i.data,i.width,i.height),i}function u(t){for(var i=t,a=arguments.length,e=Array(a>1?a-1:0),r=1;r<a;r++)e[r-1]=arguments[r];return e.forEach(function(t){t&&Object.keys(t).forEach(function(a){i[a]=t[a]})}),i}var g=void 0,m=void 0,s=void 0,l=void 0,w=void 0,M=void 0,p=void 0,x=void 0,R=void 0,S=void 0,I=void 0,y=void 0,k=void 0,P=void 0,D=void 0,b=void 0,W=function(t,i,a,e,r,o){var n=e,h=r;n>=a?n=a-1:n<0&&(n=0),h>=i?h=i-1:h<0&&(h=0);var f=n*i+h;return f*=4,t[f+o]},B=function(t){var i=t;return i=Math.min(255,i),i=Math.max(0,i)},E=function(t){var i=t;g=i[1][1],m=-.5*i[1][0]+.5*i[1][2],s=i[1][0]-2.5*i[1][1]+2*i[1][2]-.5*i[1][3],l=-.5*i[1][0]+1.5*i[1][1]-1.5*i[1][2]+.5*i[1][3],w=-.5*i[0][1]+.5*i[2][1],M=.25*i[0][0]-.25*i[0][2]-.25*i[2][0]+.25*i[2][2],p=-.5*i[0][0]+1.25*i[0][1]-i[0][2]+.25*i[0][3]+.5*i[2][0]-1.25*i[2][1]+i[2][2]-.25*i[2][3],x=.25*i[0][0]-.75*i[0][1]+.75*i[0][2]-.25*i[0][3]-.25*i[2][0]+.75*i[2][1]-.75*i[2][2]+.25*i[2][3],R=i[0][1]-2.5*i[1][1]+2*i[2][1]-.5*i[3][1],S=-.5*i[0][0]+.5*i[0][2]+1.25*i[1][0]-1.25*i[1][2]-i[2][0]+i[2][2]+.25*i[3][0]-.25*i[3][2],I=i[0][0]-2.5*i[0][1]+2*i[0][2]-.5*i[0][3]-2.5*i[1][0]+6.25*i[1][1]-5*i[1][2]+1.25*i[1][3]+2*i[2][0]-5*i[2][1]+4*i[2][2]-i[2][3]-.5*i[3][0]+1.25*i[3][1]-i[3][2]+.25*i[3][3],y=-.5*i[0][0]+1.5*i[0][1]-1.5*i[0][2]+.5*i[0][3]+1.25*i[1][0]-3.75*i[1][1]+3.75*i[1][2]-1.25*i[1][3]-i[2][0]+3*i[2][1]-3*i[2][2]+i[2][3]+.25*i[3][0]-.75*i[3][1]+.75*i[3][2]-.25*i[3][3],k=-.5*i[0][1]+1.5*i[1][1]-1.5*i[2][1]+.5*i[3][1],P=.25*i[0][0]-.25*i[0][2]-.75*i[1][0]+.75*i[1][2]+.75*i[2][0]-.75*i[2][2]-.25*i[3][0]+.25*i[3][2],D=-.5*i[0][0]+1.25*i[0][1]-i[0][2]+.25*i[0][3]+1.5*i[1][0]-3.75*i[1][1]+3*i[1][2]-.75*i[1][3]-1.5*i[2][0]+3.75*i[2][1]-3*i[2][2]+.75*i[2][3]+.5*i[3][0]-1.25*i[3][1]+i[3][2]-.25*i[3][3],b=.25*i[0][0]-.75*i[0][1]+.75*i[0][2]-.25*i[0][3]-.75*i[1][0]+2.25*i[1][1]-2.25*i[1][2]+.75*i[1][3]+.75*i[2][0]-2.25*i[2][1]+2.25*i[2][2]-.75*i[2][3]-.25*i[3][0]+.75*i[3][1]-.75*i[3][2]+.25*i[3][3]},O=function(t,i){var a=t*t,e=i*i,r=e*i;return g+m*i+s*e+l*r+(w+M*i+p*e+x*r)*t+(R+S*i+I*e+y*r)*a+(k+P*i+D*e+b*r)*(a*t)},U=-1,j={width:80,height:80,mime:"image/png",processType:1},z={quality:.92,mime:"image/jpeg",compressScaleRatio:1,iphoneFixedRatio:1.5,isUseOriginSize:!1,maxWidth:0,forceWidth:0,forceHeight:0},q={};return function(t){function a(t){var i=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/i}var e=t;e.scaleImageData=function(t,a,e){(0,[i,r,n,v][u({},j,e).processType])(t,a)},e.scaleImage=function(t,i){var a=t.width,r=t.height,o=u({},j,i),n=document.createElement("canvas"),h=n.getContext("2d");n.width=a,n.height=r,h.drawImage(t,0,0,a,r);var f=h.getImageData(0,0,a,r),d=h.createImageData(o.width,o.height);return e.scaleImageData(f,d,o),n.width=d.width,n.height=d.height,h.putImageData(d,0,0,0,0,n.width,n.height),n.toDataURL(o.mime,.9)},e.compressImage=function(t,i){var e=t.width,r=t.height,o=e/r,n=u({},z,i),h=document.createElement("canvas"),f=h.getContext("2d"),d=a(f);d*=n.compressScaleRatio||1,navigator.userAgent.match(/(iPhone\sOS)\s([\d_]+)/)&&(d*=n.iphoneFixedRatio||1);var c=window.innerWidth*d;(n.isUseOriginSize||c>e)&&(c=e);var v=n.maxWidth;v&&e>v&&c>v&&(c=v);var g=n.forceWidth,m=n.forceHeight;g&&(c=g);var s=c/o;return m&&(s=m),h.width=c,h.height=s,f.drawImage(t,0,0,e,r,0,0,h.width,h.height),h.toDataURL(n.mime,n.quality)}}(q),q});